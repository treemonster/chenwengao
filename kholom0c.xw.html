<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
<script src="113771a6b5fa02364ad0b4c3ae875906.js"></script>
<script src="587c00a37d48f330c5e56e5cefc3f869.js"></script>
<script src="b66aacb5e99aa53ad01dcadacd6b6297.js"></script>
<link href="c1d2a7298f058af74e78b7de34d866dc.css" type='text/css' rel='stylesheet' />
<link href="dcefa686817bc6c10e3f1657cb16e18e.css" type='text/css' rel='stylesheet' />
<link href="ac8dd0bda0b1d6e0fe02884ae36fb4a2.css" type='text/css' rel='stylesheet' />

<title>合并开发分支应该用 git rebase</title>

<body class="readonly github-io">
<div class='tabc'>
<div class='datelist-btn white-btn'>展开目录</div>
<div class="tabsr">
  <div class="tabsr-title">合并开发分支应该用 git rebase</div>
  <div class="tabsr-tags"><span class="tagz" style="background: #ba9f11">git</span><span class="tagz" style="background: #c16ad6">rebase</span></div>
</div>
</div>
<div class='datelist'>
  <div class='searchdiv'>
    <div class='datelist-btn-close white-btn'>X</div>
    <div class="inexport text">
      陈尼玛的博客
    </div>
    <div class="description">记录开发生涯的踩坑经历，用时间来验证成长</div>
    <input id='searchtitle' placeholder="搜索标题" />
  </div>
  <div id='lst'></div>
</div>

<div id='loading1'>加载中<span></span></div>

<div id="content">
<div id="content2"><p>一般项目都有prod（开发分支），master（线上主分支），release（预发布分支）构成。</p>
<p>以往我的开发流程：</p>
<ol>
<li><p>git checkout prod</p>
</li>
<li><p>git checkout -b dev/newxx</p>
</li>
<li><p>在 <code>dev/newxx</code> 上开发功能</p>
</li>
<li><p>每天做完一些commit一次到 <code>dev/newxx</code> 上，commit日志随便打，反正没人看</p>
</li>
<li><p>终于做完了，把 <code>dev/newxx</code> 合并到 <code>release</code> 分支，然后提测</p>
</li>
<li><p>git checkout release</p>
</li>
<li><p>git merge dev/newxx</p>
</li>
<li><p>提测</p>
</li>
<li><p>测试完成后，合并到master准备上线</p>
</li>
<li><p>git checkout prod</p>
</li>
<li><p>git merge dev/newxx</p>
</li>
<li><p>上线</p>
</li>
</ol>
<p>这样做流程上没问题，但如果翻master分支上的git记录就会发现比较混乱。</p>
<p>把记录打印出来：</p>
<pre><code>git log --graph --pretty=oneline --abbrev-commit --format=short</code></pre>
<p><img src="fbe4a831f37b1d20190e0e73291d28e1" alt="image.png"></p>
<p>看看左边这五颜六色的线条，可见主分支的流程已经乱的不可思议了。其他分支无所谓，但主分支的提交记录就应该是<font color="red">一条直线</font>，<font color="blue">每一个需求就是这个直线上的一个点</font>，这样如果真的发生线上问题需要排查或者回滚，定位记录也会简单很多。</p>
<p>不管开发的时候如何把控，实际上都不可能做到绝对没有merge的情况，也不大可能一个需求就产生一次commit，所以正确的合并到主分支的方式应该在merge之前，把自己开发分支上的提交记录都使用rebase合并成一条。</p>
<p>具体操作如下：</p>
<ol>
<li><p>当前在自己的开发分支 <code>dev/newxx</code></p>
</li>
<li><p>git log，查看自己本需求最早的一条提交记录的commitid，例如此处蓝色箭头所指记录是从prod切分支出来的记录开头，黄色箭头所指是本次开发所提交的最后一条记录</p>
<p><img src="839903b19f100bd710c35b457583ab46" alt="image.png"></p>
</li>
<li><p>git rebase -i b3fa176e9350d924d147e7d985368326465f08fa</p>
</li>
<li><p>此时把头上 <code>pick</code> 改成 <code>s</code>，然后保存退出编辑器</p>
<p><img src="46cd400702c04ae1bb41e7fb3a5715de" alt="image.png"></p>
</li>
<li><p>保存后rebase命令就会开始工作，如果中途遇到冲突则按照提示把冲突修改，然后依次运行<code>git add .</code>,<code>git rebase --continue</code>，最后rebase命令会要求输入合并后的commit信息，这个信息一般写需求相关的就可以了</p>
</li>
<li><p>此时这两条记录已合并为一条</p>
</li>
<li><p>切换到prod分支，把这个分支合并上去就可以了，<code>--no-ff</code>参数表示不需要增加额外的merge提交记录，默认会在合并之后多一条commit，内容是<code>merge xx into prod</code>这样的</p>
<pre><code>git merge dev/newxx-1 --no-ff</code></pre>
</li>
</ol>
<blockquote>
<h3 id="相关文档">相关文档</h3>
<p>暂无</p>
</blockquote>
<blockquote>
<h3 id="随便看看">随便看看</h3>
</blockquote>
<ol>
<li><p><a href="kholh68o.5y.html">git 大小写不区分问题</a></p>
</li>
<li><p><a href="kher9bkc.qhc.html">定长消息队列读写优化</a></p>
</li>
<li><p><a href="kh4hp50y.c3p.html">nginx用域名来转发请求</a></p>
</li>
<li><p><a href="kh4hp58c.8w7.html">模拟307跳转情况</a></p>
</li>
<li><p><a href="kh4hp596.lj.html">webrtc泄漏本地ip信息</a></p>
</li>
<li><p><a href="kh4hp5ae.oak.html">dd备份/还原</a></p>
</li>
<li><p><a href="kh4hp5bk.27.html">cdn资源列表</a></p>
</li>
<li><p><a href="kh4hp5cd.lmo.html">TIME_WAIT过多</a></p>
</li>
<li><p><a href="kh4hp5e1.ou.html">git 设置代理服务器</a></p>
</li>
<li><p><a href="kh4hp5fb.n3u.html">把树莓派的存储空间拓展到整张TF卡中</a></p>
</li>
<li><p><a href="kh4ib7jk.t1.html">mongodb2.4 添加用户</a></p>
</li>
<li><p><a href="88180.html">树莓派配置wifi</a></p>
</li>
<li><p><a href="88103.html">ie8上Image.onload不触发问题</a></p>
</li>
<li><p><a href="83845.html">配置mysql ssl连接</a></p>
</li>
<li><p><a href="79146.html">linux 批量替换文本内容</a></p>
</li>
</ol>

</div>
<div id="SOHUCS" sid="kholom0c.xw" ></div>
<div id='loading_cy'>畅言模块加载中</div>
</div>

<div class="body-mask"></div>

<script type="text/javascript">
window.dd_qid="kholom0c.xw";
window.CY_APPID="cyv9pom35";
window.CY_CONF="d6c8b1e7944bef3d81664b4a5efe42ad";
</script>
<script src="2c0fc1296c52c2f5b397c35dc56a4907.js"></script>
</body>
